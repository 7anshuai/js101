<!DOCTYPE HTML>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="nico 0.5.2">
    <meta name="theme" content="one 0.2">
    <meta name="baidu-site-verification" content="mQA8r0mibu">
    <title>JS101:&nbsp;Object.create</title>
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="favicon" type="image/png" sizes="16x16" href="/favicon.ico" />
    <link rel="icon" sizes="16x16" type="image/png" href="/favicon-16x16.png" />
    <link rel="icon" sizes="32x32" type="image/png" href="/favicon-32x32.png" />
    <link rel="alternate" type="application/rss+xml" href="/feed.xml" title="JS101" />
    <link rel="stylesheet" href="../static/one.css" />
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-50612052-1']);
      _gaq.push(['_trackPageview']);
      _gaq.push(['_trackPageLoadTime']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body>
    <div class="header">
      <div class="container">
        <div class="brand">
          <a class="home" href="../">JS101</a>
        </div>
        <div class="menu" role="navigation">
          <a href="../../../../../feed.xml">订阅</a>
        </div>
      </div>
    </div>
    <div class="document yue">
<div class="hentry" itemscope itemtype="http://schema.org/Article">
  <h1 class="entry-title" itemprop="name">Object.create</h1>
  <div class="entry-content" itemprop="articleBody"><p>The inheritance examples we looked at last week used the form <code>Rectangle.prototype = new Shape()</code>. The reason I like this example is it shows how powerful prototypes are, despite their simplicity. The downside is the constructor for the parent object is executed, which isn&#39;t always what&#39;s desired.</p>
<p>ECMAScript 5 introduced <code>Object.create</code>, which creates new objects based on a prototype object and an additional set of properties.</p>
<p>The main differences between <code>B.prototype = new A()</code>; and <code>B.prototype = Object.create(A.prototype)</code> are as follows:</p>
<p>The constructor, <code>A</code> isn&#39;t called, so <code>B</code> remains uninitialised until instantiated
<code>Object.create</code> accepts a second argument that causes <code>Object.create</code> to behave as if <code>Object.defineProperties</code> was called</p>
<h2 id="using-object-create">Using <code>Object.create</code></h2><p>Last week&#39;s <code>Shape</code> example could be rewritten to use <code>Object.create</code>:</p>
<div class="highlight"><pre><code class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">Shape</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.x = <span class="number">0</span>;
  <span class="keyword">this</span>.y = <span class="number">0</span>;
  console.log(<span class="string">'Shape constructor called'</span>);
}

Shape.prototype = {
  move: <span class="function"><span class="keyword">function</span><span class="params">(x, y)</span> {</span>
    <span class="keyword">this</span>.x += x;
    <span class="keyword">this</span>.y += y;
  }
};

<span class="comment">// Rectangle</span>
<span class="function"><span class="keyword">function</span> <span class="title">Rectangle</span><span class="params">()</span> {</span>
  console.log(<span class="string">'Rectangle constructor called'</span>);
  <span class="keyword">this</span>.x = <span class="number">0</span>;
  <span class="keyword">this</span>.y = <span class="number">0</span>;
}

Rectangle.prototype = Object.create(Shape);</code></pre></div><p>Now rectangles can be created with <code>var rect = new Rectangle()</code> and the original <code>Shape</code> constructor won&#39;t be called. This leaves us with a cleaner prototype chain, but what if we still want to call the previous constructor? In this particular example, calling the <code>Shape</code> constructor is desirable because we&#39;ll avoid duplicating some initialisation code.</p>
<h2 id="calling-constructors">Calling Constructors</h2><p>By using the <code>Function.prototype.call</code> or <code>apply</code> methods, it&#39;s entirely possible to call another constructor even when using <code>Object.create</code>. For example:</p>
<div class="highlight"><pre><code class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">Shape</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.x = <span class="number">0</span>;
  <span class="keyword">this</span>.y = <span class="number">0</span>;
  console.log(<span class="string">'Shape constructor called'</span>);
}

Shape.prototype = {
  move: <span class="function"><span class="keyword">function</span><span class="params">(x, y)</span> {</span>
    <span class="keyword">this</span>.x += x;
    <span class="keyword">this</span>.y += y;
  }
};

<span class="comment">// Rectangle</span>
<span class="function"><span class="keyword">function</span> <span class="title">Rectangle</span><span class="params">()</span> {</span>
  console.log(<span class="string">'Rectangle constructor called'</span>);
  Shape.call(<span class="keyword">this</span>);
}

Rectangle.prototype = Object.create(Shape.prototype);</code></pre></div><p>The fact <code>call</code> and <code>apply</code> take a <code>this</code> parameter (known as <em>ThisBinding</em> in the ECMAScript specification) allows us to reuse constructors where required.</p>
<h2 id="no-inheritance-object-create-null">No Inheritance: Object.create(null)</h2><p>By passing <code>null</code> to <code>Object.create</code>, objects can be created that don&#39;t inherit from anything. By default <code>Object.prototype</code> is used, which has several <a href="http://es5.github.io/#x15.2.4">built-in methods</a>. What if we don&#39;t want to inherit from <code>Object.prototype</code>?</p>
<div class="highlight"><pre><code class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">Shape</span><span class="params">()</span> {</span>
}

Shape.prototype = Object.create(<span class="literal">null</span>);

<span class="keyword">var</span> shape = <span class="keyword">new</span> Shape();
console.log(shape.toString);</code></pre></div><p>In this example, <code>undefined</code> will be printed -- objects created using the <code>Shape</code> constructor inherit from <code>null</code>.</p>
<p>Notice that this is not equivalent:</p>
<div class="highlight"><pre><code class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">Shape</span><span class="params">()</span> {</span>
}

Shape.prototype = <span class="literal">null</span>;

<span class="keyword">var</span> shape = <span class="keyword">new</span> Shape();
console.log(shape.toString);</code></pre></div><p>This should print something like <code>[Function: toString]</code> rather than <code>undefined</code>.</p>
<p>It&#39;s interesting to think about exactly why this is useful. In <a href="http://www.devthought.com/2012/01/18/an-object-is-not-a-hash/">An Object is not a Hash</a>, Guillermo Rauch discusses how the properties of <code>Object.prototype</code> can be used to potentially cause security issues, and <code>Object.create(null)</code> was suggested as a suitable means for creating a &quot;clean&quot; object to avoid the problem.</p>
<p>Another point is performance. These <a href="http://jsperf.com/object-create-null-iteration/2">Object.create(null) benchmarks</a> demonstrate iterating over various objects, and the <code>Object.create(null)</code> tests run faster than object literals.</p>
<p>However, be very careful when using this approach because so many libraries expect objects to have the standard methods.</p>
<h2 id="the-second-argument-to-object-create">The Second Argument to <code>Object.create</code></h2><p>According to the <a href="http://es5.github.io/#x15.2.3.5">Annotated ECMAScript 5 Object.create documentation</a>, passing a second argument behaves as if <code>Object.defineProperties</code> had been called. This method requires a bit of knowledge before it can be used -- the properties have to be passed in the expected format.</p>
<p>In this example, <code>Rectangle</code> inherits from <code>Shape</code> and gets a property called <code>animate</code> at the same time:</p>
<div class="highlight"><pre><code class="javascript">Rectangle.prototype = Object.create(Rectangle.prototype, {
  animate: {
    value: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
      <span class="keyword">this</span>.animating = <span class="literal">true</span>;
    }
  }
});

<span class="keyword">var</span> rect = <span class="keyword">new</span> Rectangle();</code></pre></div><p>Now <code>rect.animate()</code> can be called, just like any other method. Notice that the second argument is in the form <code>{ propertyName: { value: function() {} } }</code> -- the <code>value</code> property is important and I haven&#39;t arbitrarily picked it. These properties are known as <a href="http://es5.github.io/#x8.6.1">property attributes</a>.</p>
<p>Property attributes can be &quot;named data&quot; and &quot;named attribute&quot; properties. These additional flags can be applied to named data properties:</p>
<ul>
<li><code>writable</code>: Determines if the property is writable</li>
<li><code>enumerable</code>: Should this property be included in <code>for-in</code> enumeration?</li>
<li><code>configurable</code>: If <code>false</code>, attempts to delete or change the property&#39;s attributes will fail</li>
</ul>
<p>Although this is new to ECMAScript 5, it adds a much desired level of control to properties and their definition.</p>
<h2 id="getters-and-setters">Getters and Setters</h2><p>Property attributes allow JavaScript to support getters and setters with a lightweight syntax:</p>
<div class="highlight"><pre><code class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">Rectangle</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>._animating = <span class="literal">false</span>;
}

Rectangle.prototype = Object.create(Shape.prototype, {
  animating: {
    get: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
      console.log(<span class="string">'Rectangle.prototype.animating get'</span>);
      <span class="keyword">return</span> <span class="keyword">this</span>._animating;
    },

    set: <span class="function"><span class="keyword">function</span><span class="params">(value)</span> {</span>
      console.log(<span class="string">'Rectangle.prototype.animating set'</span>);
      <span class="keyword">this</span>._animating = value;
    }
  }
});

<span class="keyword">var</span> rect = <span class="keyword">new</span> Rectangle();

rect.animating = <span class="literal">true</span>;
console.log(rect.animating);</code></pre></div><p>In this example I&#39;ve renamed <code>animating</code> to <code>_animating</code>, but it can still be accessed using <code>rect.animating</code> because I&#39;ve defined an <code>animating</code> property with a <code>get</code> and <code>set</code> method.</p>
<p>This makes it possible to track whenever this value is changed, as illustrated by the <code>console.log</code> calls.</p>
<p>In JavaScript implementations that don&#39;t include <code>Object.create</code>, this second argument may not be supported. The <a href="http://kangax.github.com/es5-compat-table/">ECMAScript 5 compatibility table</a> by Kangax has a wide range of compatibility tests that can help you decide if it&#39;s safe to use it.</p>
</div>
</div>
</div>
    <div class="footer">
 <p class="copyright">Maintained by <a href="http://7anshuai.js.org/">@7anshuai</a></p>
      <p class="copyright">powered by <a href="http://lab.lepture.com/nico/">nico</a> 0.5.2</p>
    </div>
    <div class="github"><a class="github-link" href="https://github.com/7anshuai/js101">Fork me on GitHub</a></div>
    <script src="../static/one.js"></script>
  </body>
</html>
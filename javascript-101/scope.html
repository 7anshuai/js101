<!DOCTYPE HTML>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="nico 0.5.2">
    <meta name="theme" content="one 0.2">
    <title>JS101:&nbsp;Scope</title>
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="favicon" type="image/png" sizes="16x16" href="/favicon.ico" />
    <link rel="icon" sizes="16x16" type="image/png" href="/favicon-16x16.png" />
    <link rel="icon" sizes="32x32" type="image/png" href="/favicon-32x32.png" />
    <link rel="alternate" type="application/rss+xml" href="/feed.xml" title="JS101" />
    <link rel="stylesheet" href="../static/one.css" />
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-50612052-1']);
      _gaq.push(['_trackPageview']);
      _gaq.push(['_trackPageLoadTime']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body>
    <div class="header">
      <div class="container">
        <div class="brand">
          <a class="home" href="../">JS101</a>
        </div>
        <div class="menu" role="navigation">
          <a href="../../../../../feed.xml">订阅</a>
        </div>
      </div>
    </div>
    <div class="document yue">
<div class="hentry" itemscope itemtype="http://schema.org/Article">
  <h1 class="entry-title" itemprop="name">Scope</h1>
  <div class="entry-content" itemprop="articleBody"><p>&quot;Scope&quot; refers to the variables that are available to a piece of code at a given time. A lack of understanding of scope can lead to frustrating debugging experiences. The idea of scope is that it&#39;s where certain functions or variables are accessible from in our code, and the context in which they exist and are executed in.</p>
<p>There are two types of scopes in JavaScript: global and local. Let&#39;s talk about each of them in turn.</p>
<h2 id="global-scope">Global Scope</h2><p>The first scope is <strong>Global Scope</strong>. This is very easy to define. If a variable or function is <em>global</em>, it can be accessed from anywhere within a program. In a browser, the global scope is the <code>window</code> object. If a variable declaration occurs outside of a function, then that variable exists on the global object. For example:</p>
<div class="highlight"><pre><code class="javascript"><span class="keyword">var</span> x = <span class="number">9</span>;</code></pre></div><p>Once that variable had been defined, it could be referenced as <code>window.x</code>, but because it exists on the global object we can simply refer to it as <code>x</code>.</p>
<h2 id="local-scope">Local Scope</h2><p>JavaScript also creates a <strong>Local Scope</strong> inside each function body. For example:</p>
<div class="highlight"><pre><code class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> x = <span class="number">5</span>;
}

myFunc();

console.log( x ); <span class="comment">// ReferenceError: x is not defined</span></code></pre></div><p>Since <code>x</code> was initialized within <code>.myFunc()</code>, it is only accessible within <code>.myFunc()</code>, and we get a reference error if we try to access it outside of <code>.myFunc()</code>.</p>
<h2 id="a-word-of-caution">A Word of Caution</h2><p>If you declare a variable and forget to use the <code>var</code> keyword, that variable is automatically made global. So this code would work:</p>
<div class="highlight"><pre><code class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span><span class="params">()</span> {</span>
    x = <span class="number">5</span>;
}

myFunc();

console.log( x ); <span class="comment">// 5</span></code></pre></div><p>This is a bad idea. Any variable that is global can have its value changed by any other parts of a program or any other script. This is undesirable, as it could lead to unforeseen side effects.</p>
<p>Secondly, Immediately-Invoked Function Expressions provide a way to avoid global variables. You&#39;ll see many libraries such as  jQuery often use these:</p>
<div class="highlight"><pre><code class="javascript">(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> jQuery = { <span class="comment">/* All my methods go here. */</span> };
    window.jQuery = jQuery;
})();</code></pre></div><p>Wrapping everything in a function which is then immediately invoked means all the variables within that function are bound to the <em>local scope</em>. At the very end you can then expose all your methods by binding the <code>jQuery</code> object to the <code>window</code>, the <em>global object</em>. To read more about Immediately-Invoked Functions, check out Ben Alman&#39;s <a href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/">Immediately-Invoked Function Expression</a> article.</p>
<p>Because local scope works through functions, any functions defined within another have access to variables defined in the outer function:</p>
<div class="highlight"><pre><code class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">outer</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> x = <span class="number">5</span>;

    <span class="function"><span class="keyword">function</span> <span class="title">inner</span><span class="params">()</span> {</span>
        console.log( x );
    }

    inner(); <span class="comment">// 5</span>
}</code></pre></div><p>But the <code>.outer()</code> function doesn&#39;t have access to any variables declared within <code>.inner()</code>:</p>
<div class="highlight"><pre><code class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">outer</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> x = <span class="number">5</span>;

    <span class="function"><span class="keyword">function</span> <span class="title">inner</span><span class="params">()</span> {</span>
        console.log( x );
        <span class="keyword">var</span> y = <span class="number">10</span>;
    }

    inner(); <span class="comment">// 5</span>

    console.log( y ); <span class="comment">// ReferenceError: y is not defined</span>
}</code></pre></div><p>Furthermore, variables that are declared inside a function without the <code>var</code> keyword are not local to the function – JavaScript will traverse the scope chain all the way up to the window scope to find where the variable was previously defined. If the variable wasn&#39;t previously defined, it will be defined in the global scope, which can have unexpected consequences.</p>
<div class="highlight"><pre><code class="javascript"><span class="comment">// Functions have access to variables defined in the same scope.</span>

<span class="keyword">var</span> foo = <span class="string">"hello"</span>;

<span class="keyword">var</span> sayHello = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    console.log( foo );
};

sayHello(); <span class="comment">// "hello"</span>

console.log( foo ); <span class="comment">// "hello"</span></code></pre></div><p>Variables with the same name can exist in different scopes with different values:</p>
<div class="highlight"><pre><code class="javascript"><span class="keyword">var</span> foo = <span class="string">"world"</span>;

<span class="keyword">var</span> sayHello = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> foo = <span class="string">"hello"</span>;
    console.log( foo );
};

sayHello(); <span class="comment">// "hello"</span>

console.log( foo ); <span class="comment">// "world"</span></code></pre></div><p>When, within a function, you reference a variable defined in an outer scope, that function can see changes to the variable&#39;s value after the function is defined.</p>
<div class="highlight"><pre><code class="javascript"><span class="keyword">var</span> myFunction = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> foo = <span class="string">"hello"</span>;
    <span class="keyword">var</span> myFn = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        console.log( foo );
    };
    foo = <span class="string">"world"</span>;
    <span class="keyword">return</span> myFn;
};

<span class="keyword">var</span> f = myFunction();

f(); <span class="comment">// "world"</span></code></pre></div><p>Here&#39;s a more complex example of scopes at play:</p>
<div class="highlight"><pre><code class="javascript">(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>

    <span class="keyword">var</span> baz = <span class="number">1</span>;

    <span class="keyword">var</span> bim = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        console.log( baz );
    };

    bar = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        console.log( baz );
    };

})();</code></pre></div><p>In this instance, running:</p>
<div class="highlight"><pre><code class="javascript">console.log( baz ); <span class="comment">// baz is not defined outside of the function</span></code></pre></div><p>Gives us a <code>ReferenceError</code>. <code>baz</code> was only defined within the function, and was never exposed to the global scope.</p>
<div class="highlight"><pre><code class="javascript">bar(); <span class="comment">//  1</span></code></pre></div><p><code>.bar()</code> may have been defined within the anonymous function, but it was defined without the <code>var</code> keyword, which means it wasn&#39;t bound to the local scope and was instead created globally. Furthermore, it has access to the <code>baz</code> variable because <code>.bar()</code> was defined within the same scope as <code>baz</code>. This means it has access to it, even though other code outside of the function does not.</p>
<div class="highlight"><pre><code class="javascript">bim(); <span class="comment">// ReferenceError: bim is not defined</span></code></pre></div><p><code>.bim()</code> was only defined within the function, so does not exist on the global object as it was defined locally.</p>
</div>
</div>
</div>
    <div class="footer">
      <p class="copyright">powered by <a href="http://lab.lepture.com/nico/">nico</a> 0.5.2</p>
    </div>
    <div class="github"><a class="github-link" href="https://github.com/7anshuai/js101">Fork me on GitHub</a></div>
    <script src="../static/one.js"></script>
  </body>
</html>